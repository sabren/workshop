<?xml version="1.0"?>
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>whip up a web app</title>
</head>
<body>


<h1>create a directory for your site</h1>

<pre>
cd sites\bodyblog
paster serve --reload bodyblog.app
</pre>

<h1>design your object model</h1>

<p>Two layers, often very similiar:</p>

<ul>
<li>database layer [primary/foreign keys]</li>
<li>object layer [calculated fields, lazy loading, etc]</li>
</ul>

<h2>create the database connection</h2>


<h2>create the database tables</h2>

<pre>
CREATE TABLE shop_product (
  ID int(11) NOT NULL auto_increment,
  parentID int(11) DEFAULT '0' NOT NULL,
  code varchar(32) DEFAULT '' NOT NULL,
  name varchar(50),
  price decimal(8,2),
  cost decimal(8,2),
  retail decimal(8,2),
  descSize varchar(50),
  descript text,
  isHidden tinyint(1) DEFAULT '0',
  pictureID int(11),
  warn int(11) DEFAULT '0',
  siteID int(11),
  ts timestamp(14),
  weight decimal(5,2),
  stock int(11) DEFAULT '0',
  hold int(11) DEFAULT '0',
  PRIMARY KEY (ID)
);
</pre>

<h2>create strongbox class for each table in db</h2>

  use cornerhost/schema/ directory for examples
  dates: from pytypes import DateTime
  - start with Blog / Post objects .. ask michal if need help


<h2>map classes to tables with dbmap</h2>

<p>see trac: <a href="https://secure.sabren.com/trac/cornerops/browser/cornerhost/trunk/cornerhost/dbmap.py">cornerhost/dbmap.py</a></p>


<h2></h2>

 add to bodyblog.py:  
   a Clerk that takes storage.MySQLStorage (see workshop trac)
   something like: clerks.Clerk(SCHEMA(dbmap), MySQLStorage(dbc))



<h2>Test: you should be able to create a Product now:</h2>

<pre><![CDATA[
# create clerk manually
>>> from bodyblog import Post
>>> post = clerk.fetch(Post, ID=x) # where x = some id out of the db
>>> post.BlogText = "blah blah blah"
>>> clerk.store(post)
]]></pre>


and it should update live bodyblog site.

<hr/>



* define a "update post" handler


  # in bodyblog.py:
  class StorePostCommand(object):
      def invoke(self, _clerk, ID):
          
   _clerk.fetch(Post, int(ID) )
   Post.update(xxxx)
   _clerk.store(Post)



* define a RESTful API
  ex: amoeba.py 


  edit posts:
   self.rest = REST(
     URI("/posts/(?P<ID>[0-9]+)$",
         PUT=))

     no browser support for PUT, so: tunnel through post with:

     <form action="/posts/${id}
     <input type="hidden" name="@method" value="PUT">



*   new post:
     POST /posts/

* copy layout.gen from amoeba to theme\default

* make it look like bodyblog but valid html (clean up as desired)
  
</body>
</html>